g3={};var ebrown=ebrown||{};ebrown.g3=g3,g3.checkUndefined=function(e,a,t){return null===t[e]||void 0===t[e]?a:t[e]},g3.elementWidth=function(e){return e[0][0].clientWidth},g3.elementHeight=function(e){return e[0][0].clientHeight},g3.marginObject=function(e){var a=g3.checkUndefined("height",300,e),t=g3.checkUndefined("width",300,e),n=g3.checkUndefined("marginsize",300,e);return{top:a*n,right:t*n,bottom:a*n,left:t*n}},g3.chartLength=function(e,a,t){return e-a-t},g3.appendChart=function(e,a,t,n){return e.append("svg").attr("width",a).attr("height",t).append("g").attr("transform","translate("+n.left+","+n.top+")")},g3.linearScale=function(e){var a=g3.checkUndefined("min",0,e),t=g3.checkUndefined("max",void 0,e);return(null===e.min||void 0===e.min)&&(a=0),(null===e.max||void 0===e.max)&&(t=0),d3.scale.linear().range([a,t])},g3.ordinalScale=function(e){var a=g3.checkUndefined("min",0,e),t=g3.checkUndefined("max",void 0,e),n=g3.checkUndefined("space",.3,e),i=d3.scale.ordinal().rangeRoundBands([a,t],n);return i},g3.scale=function(e){var a=g3.checkUndefined("type","linear",e);g3.checkUndefined("min",0,e),g3.checkUndefined("max",100,e),g3.checkUndefined("space",.3,e);return"bar"===e.geom&&(a="ordinal"),"linear"===a?g3.linearScale(e):"ordinal"===a?g3.ordinalScale(e):void 0},g3.createTitle=function(e,a,t,n){null===a||"undefined"===a||e.append("text").attr("x",t/2).attr("y",0-n.top/2).attr("text-anchor","middle").style("font-size","1em").text(a)},g3.labelx=function(e,a,t,n,i){null===a||"undefined"===a||e.append("text").attr("x",t/2).attr("y",n+.75*i.bottom).attr("dx","1em").attr("text-anchor","middle").text(a)},g3.labely=function(e,a,t,n){null===a||"undefined"===a||e.append("text").attr("transform","rotate(-90)").attr("x",0-t/2).attr("y",0-n.left).attr("dy","1em").attr("text-anchor","middle").text(a)},g3.axis=function(e){var a=e.dimension;if("x"===a)var t=g3.checkUndefined("orient","bottom",e);else if("y"===a)var t=g3.checkUndefined("orient","left",e);var n=g3.checkUndefined("ticks",void 0,e),i=g3.checkUndefined("scale",void 0,e),r=d3.svg.axis().scale(i).orient(t);return void 0===n||(r=r.ticks(n)),r},g3.hsl2rgb=function(e,a,t){var n,i,r,l,d,c;return a/=100,t/=100,e-=360*Math.floor(e/360),0==a?l=d=c=255*t:(i=.5>=t?t*(a+1):t+a-t*a,n=2*t-i,r=e/360,l=HueToRgb(n,i,r+1/3),d=HueToRgb(n,i,r),c=HueToRgb(n,i,r-1/3)),[l,d,c]},g3.addStyle=function(e,a,t,n){if(null===n||"undefined"===n){d3.selectAll(e+" ."+t).style(a,"#444")}else{d3.selectAll(e+" ."+t).style(a,n)}},g3.plotLayer=function(e,a,t){var n=a.layer[t],i=a.panel,r=n.geom||void 0,l=n.shape,d=n.idclass,c=n.data,o=n.xscale,g=n.yscale,s=n.xvar,h=n.yvar,f=n.radius||2;n.height;"point"===r?e.selectAll("."+d).data(c).enter().append(l).attr("class",d).attr("cx",function(e){return o(e[s])}).attr("cy",function(e){return g(e[h])}).attr("r",f):"bar"===r&&e.selectAll("."+d).data(c).enter().append(l).attr("class",d).attr("x",function(e){return o(e[s])}).attr("width",o.rangeBand()).attr("y",function(e){return g(e[h])}).attr("height",function(e){return i.chartHeight-g(e[h])})},g3.addLayer=function(e,a){var t=e.layer,n={geom:a.geom||void 0,idclass:a.idclass||"",data:a.data||e.base.data,xscale:a.xscale||e.base.xscale,yscale:a.yscale||e.base.yscale,xvar:a.xvar||e.base.xvar};return t.push(n),e},g3.makeList=function(e){var a={base:{},panel:{},layer:[]};return a.base={par:e.par||void 0,data:e.data||void 0,xvar:e.xvar||void 0,yvar:e.yvar||void 0,xscale:e.xscale||void 0,yscale:e.ysale||void 0,colour:e.colour||void 0},a.panel={title:e.title||void 0,xlab:e.xlab||void 0,ylab:e.ylab||void 0,marginsize:e.marginsize||void 0},a},g3.plotList=function(e){var a=g3.makeList(e);console.log(a);var t=a.panel.marginsize||.1,n=d3.select(a.base.par),i=g3.elementWidth(n),r=g3.elementHeight(n),l=g3.marginObject(r,i,t),d=g3.chartLength(i,l.left,l.right),c=g3.chartLength(r,l.top,l.bottom),o=g3.appendChart(n,i,r,l),g=g3.scale({type:"linear",min:0,max:d}),s=g3.scale({type:"linear",min:c,max:0}),h=g3.axis(g,"bottom",2),f=g3.axis(s,"left",8),m=g3.checkUndefined("data",void 0,a.base),x=g3.checkUndefined("xvar",void 0,a.base),p=g3.checkUndefined("yvar",void 0,a.base);g.domain(d3.extent(m,function(e){return e[x]})),s.domain(d3.extent(m,function(e){return e[p]})),o.append("g").attr("class","x axis").attr("transform","translate(0,"+c+")").call(h),o.append("g").attr("class","y axis").call(f)},g3.plotTree=function(e){var a=e.base,t=e.panel,n=t.marginsize||.1,i=d3.select(a.par),r=g3.elementWidth(i),l=g3.elementHeight(i),d=g3.marginObject({height:l,width:r,marginsize:n}),c=g3.chartLength(r,d.left,d.right),o=g3.chartLength(l,d.top,d.bottom);t.chartWidth=c,t.chartHeight=o;var g=g3.appendChart(i,r,l,d);if("point"===e.layer[0].geom)var s=g3.scale({type:"linear",min:0,max:c}),h=g3.scale({type:"linear",min:o,max:0});else if("bar"===e.layer[0].geom)var s=g3.scale({type:"ordinal",min:0,max:c}),h=g3.scale({type:"linear",min:o,max:0});a.xscale=s,a.yscale=h;var f=g3.axis({dimension:"x",scale:s,orient:"bottom"}),m=g3.axis({dimension:"y",scale:h,orient:"left"});a.xAxis=f,a.yAxis=m;var x=g3.checkUndefined("data",void 0,e.base),p=g3.checkUndefined("xvar",void 0,e.base),u=g3.checkUndefined("yvar",void 0,e.base);s.domain(d3.extent(x,function(e){return e[p]})),h.domain(d3.extent(x,function(e){return e[u]})),g.append("g").attr("class","x axis").attr("transform","translate(0,"+t.chartHeight+")").call(a.xAxis),g.append("g").attr("class","y axis").call(a.yAxis);var v=e.layer[0],y=["geom","shape","idclass","data","xvar","yvar","xscale","yscale","radius","width","height"],b="";for(op=0;op<y.length;op++)b=y[op],v[b]=g3.checkUndefined(b,a[b],v);return"point"===v.geom?v.shape="circle":"bar"===v.geom&&(v.shape="rect",v.xscale=g3.scale({type:"ordinal",min:0,max:t.chartWidth,space:.2})),g3.plotLayer(g,e,0),g3.addStyle(e.base.par,"fill",v.idclass,e.base.colour),g3.createTitle(g,e.panel.title,c,d),g3.labelx(g,e.panel.xlab,c,o,d),g3.labely(g,e.panelylab,o,d),e};